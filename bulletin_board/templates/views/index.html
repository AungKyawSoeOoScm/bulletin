{{define "index.html"}}
<html>
    {{ template "header.html" }}
    <body>
        {{template "common_header.html"}}
        <script
            src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
        <script>
            function sendDelete(event, href, id, title, description, status) {
                event.preventDefault();
                confirmDelete(id, title, description, status).then((result) => {
                    if (result.value) {
                        var xhttp = new XMLHttpRequest();
                        xhttp.onreadystatechange = function() {
                            if (this.readyState !== 4) {
                                return;
                            }
                            if (this.readyState === 4) {
                                window.location.replace(this.responseURL);
                            }
                        };
                        xhttp.open("DELETE", href, true);
                        xhttp.send();
                    }
                });
            }

            function confirmDelete(id, title, description, status) {
                var confirmMessage = "Are you sure you want to delete the following post? <br>";
                confirmMessage += "ID: " + id + "<br>";
                confirmMessage += "Title: " + title + "<br>";
                confirmMessage += "Description: " + description + "<br>";
                confirmMessage += "Status: " + (status == 1 ? "Active" : "Inactive") + "<br>";


                return Swal.fire({
                    title: 'Confirmation',
                    html: confirmMessage,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Delete'
                });
            }
        </script>
        <a href="posts/create/" class="btn btn-primary mt-5 ms-3">Create post</a>
        <div class="container-fluid">
            <table class="table table-striped .table-responsive bs-table mt-5">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Title</th>
                        <th scope="col">Description</th>
                        <th scope="col">Posted User</th>
                        <th scope="col">Posted Date</th>
                        <th scope="col">Operation</th>
                    </tr>
                </thead>
                <tbody>
                    {{range $index, $tag := .tags}}
                    <tr>
                        <th scope="row">{{$index}}</th>
                        <td>{{.Title}}</td>
                        <td>{{.Description}}</td>
                        <td>{{.CreateUserId}}</td>
                        <td>{{.CreatedAt.Format "2006-01-02"}}</td>
                        <td>
                            <a class="btn btn-outline-primary"
                                href="/posts/update/{{.Id}}">Edit</a>
                            <a class="btn btn-outline-danger"
                                href="/posts/{{.Id}}"
                                onclick="sendDelete(event, this.href, '{{.Id}}', '{{.Title}}', '{{.Description}}', '{{.Status}}')">Delete</a>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{ template "footer.html" }}
    </body>
</html>
{{end}}
